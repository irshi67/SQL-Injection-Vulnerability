package com.example.demo.service;

import com.example.demo.model.AppUser;
import com.example.demo.repository.AppUserRepository;
import lombok.AllArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.ui.Model;
import org.springframework.validation.Errors;

import java.util.UUID;

@Service
@AllArgsConstructor
public class AppUserService {
    private final AppUserRepository appUserRepository;

    public boolean register(AppUser user,Model model){
        boolean register = false;
        if (appUserRepository.findByEmail(user.getEmail()) != null){
            model.addAttribute("error", "Email already taken");
            return register;
        }
        AppUser newUser = new AppUser();
        newUser.setId(UUID.randomUUID().getMostSignificantBits());
        newUser.setEmail(user.getEmail());
        newUser.setPassword(user.getPassword());
        appUserRepository.save(newUser);
        register = true;
        return register;
    }

    public boolean login(AppUser user,Model model){
        boolean login = false;
        AppUser tempUser = appUserRepository.findByEmailPassword(user.getEmail(),user.getPassword());
        if (tempUser != null) {
            model.addAttribute("message","You have been successfully logged in.");
            login = true;
            return login;
        } else {
            model.addAttribute("error", "Your Email or Password is invalid");
            return login;
        }
    }
}
